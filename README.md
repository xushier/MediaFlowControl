# 一条龙工具

## 使用方法

1. 青龙添加订阅。粘贴如下内容：

   `ql repo https://github.com/xushier/MediaFlowControl.git "tools/[a-z]+" "" "require|tools/__|_Conf" "" "py|txt"`

   添加完手动运行一次。

2. 在青龙依赖管理里添加 requirements.txt 里的依赖。

3. 修改拉取的脚本中的 __config.py 文件，所有脚本的配置都在该文件里，里面有详细说明。

4. 将订阅任务禁用，防止再次运行覆盖已经配置好的文件。或者将订阅改成如下格式忽略配置文件的更新：

   `ql repo https://github.com/xushier/MediaFlowControl.git "tools/[a-z]+" "_Conf" "require|tools/__" "" "py|txt"`

5. 按需要更改任务定时，或者禁用任务。

## 各脚本说明

1. 环境检测

   作用：

   - 检测 Alist、CD2、QB 的连接是否正常；
   - Alist 和 CD2 的挂载是否正常；
   - 检测完成发送通知。

   需要信息：

   - Alist、CD2、QB 连接相关配置；
   - 挂载路径。

2. CD2 信息检测

   作用：

   - 获取 CD2 相关信息，包括 CD2 挂载是否正常、空间使用信息、配额使用信息、版本信息、上传任务信息、媒体库文件数量信息。
   - 检测完成发送通知。

   需要信息：

   - CD2 连接相关配置；
   - CD2 内 115 根路径；
   - CD2 内 115 媒体库根路径；
   - 账户 ID。

3. Emby 整库刷新

   作用：

   - 刷新 Emby 整库。
   - 检测完成发送通知。

   需要信息：

   - Emby 地址；
   - Emby API Key。

4. 全量链接

   作用：

   - 依据给定的链接模式和路径进行整库全量链接。
   - 检测完成发送通知。

   需要信息：

   - 全量链接模式；
   - 挂载根路径；
   - 软链接根路径；
   - STRM 根路径；
   - Alist 根 URL；
   - 生成文件的 UID、GID、MOD；
   - 链接进度的通知间隔；

5. QB 自动化删除

   作用：

   - 删除满足指定条件的种子（已经上传到网盘的，有 HR 的满足指定站点 HR 时间的）；
   - 删除下载中的错误的种子（站点已删除）；
   - 删除未使用的分类；
   - 检测可能刮削失败的种子。
   - 检测完成发送通知。

   需要信息：

   - QB 连接相关配置；
   - 是否删除满足条件的种子；
   - 是否删除错误的种子。

6. 一条龙

   作用：

   - 将已上传到网盘的文件根据指定模式进行链接；
   - 删除硬链文件并通知 Emby 进行局部刷新；
   - 未上传的进行上传；
   - 刮削错误的将多端文件都删除；
   - 正在 CD2 上传列表的文件优先根据指定发布组、其次根据文件大小进行判断是否可以开始上传；
   - 首传的文件重新进行上传并递增等待时间，达到指定次数或时间后还是首传则放任其进行传输，不再控制。
   - 将以上各种状态的文件进行标记，发送到 QB 进行分类标记。
   - 检测完成发送通知。

   需要信息：

   - 环境检测脚本所需的信息；
   - CD2 信息检测所需的信息；
   - Emby 整库刷新脚本所需的信息；
   - QB 自动化删除所需的信息；
   - 部分链接模式；
   - 各个根路径；
   - 首传递增时间；
   - 不传输次数阈值和时间阈值。

7. 硬链文件实时监控

   作用：

   - 实时监控硬链文件夹。
   - 有新的元数据文件，下载到链接文件夹。优先从本地拷贝，其次从网盘下载。
   - 有新的视频文件，将其在 CD2 上传列表中暂停。
   - 检测完成发送通知。

   需要信息：

   - CD2 连接相关配置；
   - 各路径。